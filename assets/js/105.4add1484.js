(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{389:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"ingress介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress介绍"}},[s._v("#")]),s._v(" Ingress介绍")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("回顾Service")]),s._v(" "),t("ul",[t("li",[s._v("Servie对外暴露服务主要NodePort和LoadBlancer")]),s._v(" "),t("li",[s._v("NodePort会占用很多进群端口号")]),s._v(" "),t("li",[s._v("LB方式每个service需要一个LB,且需要集群外设备支持")])])]),s._v(" "),t("li",[t("p",[s._v("k8s提供了 Ingress 资源对象")]),s._v(" "),t("ul",[t("li",[s._v("一个NodePort或者一个LB满足多个Service的需求")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://sprintln-1256351233.cos.ap-shanghai.myqcloud.com/img/20221018214118.png",alt:"20221018214118"}})]),s._v(" "),t("ul",[t("li",[s._v("Ingress相当于一个 7 层负载均衡器")]),s._v(" "),t("li",[s._v("k8s 对反向代理的一个抽象，工作原理类似于Nginx")]),s._v(" "),t("li",[s._v("Ingress建设诸多规则，Ingress Controller通过监听配置转化成Nginx的方向代理配置，对外提供服务")])]),s._v(" "),t("h3",{attrs:{id:"ingress工作原理工作流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress工作原理工作流程"}},[s._v("#")]),s._v(" Ingress工作原理工作流程")]),s._v(" "),t("ul",[t("li",[s._v("用户编写Ingress规则，定义域名对应k8s集群哪个Service")]),s._v(" "),t("li",[s._v("Ingress控制器动态干部职工Ingress服务变化，生成Nginx配置")]),s._v(" "),t("li",[s._v("将生成的Nginx配置写入到Nginx服务，动态更新\n"),t("img",{attrs:{src:"https://sprintln-1256351233.cos.ap-shanghai.myqcloud.com/img/20221019115128.png",alt:"20221019115128"}})])]),s._v(" "),t("h2",{attrs:{id:"ingress-controller-软件安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress-controller-软件安装"}},[s._v("#")]),s._v(" Ingress controller 软件安装")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ingress-controller "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ingress-controller\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改mandatory.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 quay.io/kubernets-ingress-controller/nginx-ingress-contoroller:0.30.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为 quay-mirror.qiniu.com/kubernets-ingress-controller/nginx-ingress-contoroller:0.30.0")]),s._v("\n\nkubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./\n\nkubectl get pod-n ingress-nginx\nkubectl get svc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ingress-nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"http代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http代理"}},[s._v("#")]),s._v(" HTTP代理")]),s._v(" "),t("h3",{attrs:{id:"yaml-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml-配置文件"}},[s._v("#")]),s._v(" yaml 配置文件")]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" extensions/v1beta1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx.itheima.com\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat.itheima.com\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("访问 spec.rules.host: 域名，则转发到对应的service,的对应端口")]),s._v(" "),t("li",[t("code",[s._v("kubectl create -f xx.yml")])]),s._v(" "),t("li",[t("code",[s._v("kubectl get ing ingress-http -n dev")])]),s._v(" "),t("li",[t("code",[s._v("kubectl describe ing ingress-http -n dev")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);