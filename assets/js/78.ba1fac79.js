(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{350:function(s,e,a){"use strict";a.r(e);var t=a(14),n=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"几个重要的资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#几个重要的资源"}},[s._v("#")]),s._v(" 几个重要的资源")]),s._v(" "),e("h2",{attrs:{id:"namespace-ns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#namespace-ns"}},[s._v("#")]),s._v(" Namespace ns")]),s._v(" "),e("ul",[e("li",[s._v("边界、组")]),s._v(" "),e("li",[s._v("用于实现多套环境的资源隔离， 或者多租户的资源隔离")]),s._v(" "),e("li",[s._v("pod放在不同的ns内进行隔离，形成租的概念")]),s._v(" "),e("li",[s._v("通过k8s授权机制")]),s._v(" "),e("li",[s._v("k8s配置资源配额机制")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubectl get ns\nkubectl create ns dev\nkubectl delete ns dev\nkubectl get pod "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" dev\nkubectl describe ns default\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespace\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("kubectl create -f ns-yaml.yaml")])]),s._v(" "),e("li",[e("code",[s._v("kubectl delete -f ns-yaml.yaml")])])]),s._v(" "),e("p",[s._v("默认存在4个 ns")]),s._v(" "),e("ul",[e("li",[s._v("default 未指定ns")]),s._v(" "),e("li",[s._v("kube-node-lease 集群节点之间心跳维护")]),s._v(" "),e("li",[s._v("kube-public 可以被所有人访问，包括未认证用户")]),s._v(" "),e("li",[s._v("kube-system 所有k8s系统创建的资源")])]),s._v(" "),e("h2",{attrs:{id:"pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[s._v("#")]),s._v(" Pod")]),s._v(" "),e("ul",[e("li",[s._v("Pod k8s 集群管理的最小单元， 运行必须要部署在容器里面，容器在pod里面")]),s._v(" "),e("li",[s._v("一个pod里面有1个获多个容器")]),s._v(" "),e("li",[s._v("k8s 集群的组件也是以pod的形式运行的 "),e("code",[s._v("kubectl get pod -n kube-system")])]),s._v(" "),e("li",[s._v("创建\n"),e("ul",[e("li",[e("code",[s._v("kubectl run nginx --image=nginx:1.17.1 --port 80 -n dev")])])])]),s._v(" "),e("li",[s._v("查看\n"),e("ul",[e("li",[e("code",[s._v("kubectl get pod -n dev -o wide")])]),s._v(" "),e("li",[e("code",[s._v("kubectl describe pod pod-name -n dev")]),s._v(" 一般排错的时候使用，看Events")])])]),s._v(" "),e("li",[s._v("pod访问\n"),e("ul",[e("li",[e("code",[s._v("kubectl get pod -n dev -o wide")]),s._v(" 获取ip和端口号访问")])])]),s._v(" "),e("li",[s._v("删除\n"),e("ul",[e("li",[e("code",[s._v("kubectl delete pod pod-name -n dev")]),s._v(" "),e("ul",[e("li",[s._v("删除成功吗？删除但是会创建一个（）， 控制器 run 命令创建会使用deployment控制器（这个控制器发现pod被删了会立刻创建出来一个）")]),s._v(" "),e("li",[s._v("所以要删除控制器才能真正的删除\n"),e("ul",[e("li",[e("code",[s._v("kubectl delete deployment pod-name")])])])])])])])])]),s._v(" "),e("h2",{attrs:{id:"label"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#label"}},[s._v("#")]),s._v(" Label")]),s._v(" "),e("p",[s._v("一种标识选择机制")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("键值对的形式附加到资源上， Node, Pod, Service等")])]),s._v(" "),e("li",[e("p",[s._v("资源与标签关系时多对多")])]),s._v(" "),e("li",[e("p",[s._v("通常在资源定义的时候确定，也可以新增删除")])]),s._v(" "),e("li",[e("p",[s._v("多维度分组，灵活方便资源分配、调度、配置、部署等工作")])]),s._v(" "),e("li",[e("p",[s._v("创建标签")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl label pod nginx-pod version=1.0 -n dev")])])])]),s._v(" "),e("li",[e("p",[s._v("查看标签")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl get pod nginx-pod --show-labels -n dev")])])])]),s._v(" "),e("li",[e("p",[s._v("修改标签")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl label pod nginx-pod version=2.0 -d dev --overwrite")]),s._v(" # 覆盖字段级别的更新")])])]),s._v(" "),e("li",[e("p",[s._v("筛选标签")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl get pods -n dev -l version=2.0")])]),s._v(" "),e("li",[e("code",[s._v("kubectl get pods -n dev -l version in (2.0, 1.0)")])])])]),s._v(" "),e("li",[e("p",[s._v("删除标签")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl label pods pod-name -n dev version-")]),s._v(", 减号")])])])]),s._v(" "),e("h3",{attrs:{id:"label-selector"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#label-selector"}},[s._v("#")]),s._v(" Label Selector")]),s._v(" "),e("ul",[e("li",[s._v("基于等式 name = salve / name != salve")]),s._v(" "),e("li",[s._v("基于集合 name in (master, slave), name not in (master, slave)")])]),s._v(" "),e("h2",{attrs:{id:"deployment-deploy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deployment-deploy"}},[s._v("#")]),s._v(" Deployment deploy")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("k8s中pod最小单元，但是很少直接控制pod, 一般都是通过pod控制器")])]),s._v(" "),e("li",[e("p",[s._v("去报pod符合预期状态运行")])]),s._v(" "),e("li",[e("p",[s._v("Deployment是控制器的一种，它会在资源出现故障会尝试重启pod")])]),s._v(" "),e("li",[e("p",[s._v("deployment控制器和pod关联是通过label实现的")])]),s._v(" "),e("li",[e("p",[s._v("创建")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl run nginx --image=nginx:1.17.1 --port=80 --replicas=3 -n dev")])])])]),s._v(" "),e("li",[e("p",[s._v("删除")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl delete deploy nginx -n dev")])])])])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过标签跟pod建立关系")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pod模板")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mame")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpmtaomerPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("h2",{attrs:{id:"service-svc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-svc"}},[s._v("#")]),s._v(" Service svc")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("每个pod都会分配一个单独的pod IP")]),s._v(" "),e("ul",[e("li",[s._v("pod ip 会随着pod的重建改变")]),s._v(" "),e("li",[s._v("pod ip 是集群内的虚拟ip, 外部无法访问")])])]),s._v(" "),e("li",[e("p",[s._v("service 来解决这个问题")])]),s._v(" "),e("li",[e("p",[s._v("service 就是一组同类pod对外的访问接口")])]),s._v(" "),e("li",[e("p",[s._v("借助servie可以方便的实现 服务发现 和 负载均衡")])]),s._v(" "),e("li",[e("p",[s._v("service 也是根据label选择器来访问对应pod")])]),s._v(" "),e("li",[e("p",[s._v("创建、暴露 service (通过deploy指定对应的pod)")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev")])]),s._v(" "),e("li",[s._v("type=ClusterIP 只能集群内部访问")]),s._v(" "),e("li",[s._v("type=NodePort 创建外部可以访问的Service")])])]),s._v(" "),e("li",[e("p",[s._v("删除")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("kubectl delete svc svc-name -n dev")])])])])]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterIP")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.10.10.10 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不写的话自动分配")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterIP\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);