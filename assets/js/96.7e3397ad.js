(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{378:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"pod一般情况下声名周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod一般情况下声名周期"}},[s._v("#")]),s._v(" Pod一般情况下声名周期")]),s._v(" "),t("ul",[t("li",[s._v("pod创建过程")]),s._v(" "),t("li",[s._v("运行初始化容器过程 init container")]),s._v(" "),t("li",[s._v("运行主容器过程 main container\n"),t("ul",[t("li",[s._v("容器启动后钩子 post start,")]),s._v(" "),t("li",[s._v("容器终止前钩子 pre stop")]),s._v(" "),t("li",[s._v("容器存活性探测 livenss probe")]),s._v(" "),t("li",[s._v("就绪性探测 readiness probe")])])]),s._v(" "),t("li",[s._v("Pod 终止过程")])]),s._v(" "),t("h2",{attrs:{id:"pod-的-5种状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod-的-5种状态"}},[s._v("#")]),s._v(" Pod 的 5种状态")]),s._v(" "),t("ul",[t("li",[s._v("挂起 Pending\n"),t("ul",[t("li",[s._v("apiserver创建完了pod资源对象，但未被调度完成，或出于下载镜像中")])])]),s._v(" "),t("li",[s._v("运行中 Running\n"),t("ul",[t("li",[s._v("pod 已经被调度到某节点，并且容器已经被kubelet创建")])])]),s._v(" "),t("li",[s._v("Succeeded pod 中所有容器都已经成功终止并不会重启")]),s._v(" "),t("li",[s._v("Failed 所有容器已经终止，至少一个失败，非0返回退出")]),s._v(" "),t("li",[s._v("Unknow apiserver 无法正常获取pod状态信息，通常网络原因")])]),s._v(" "),t("h2",{attrs:{id:"pod创建过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod创建过程"}},[s._v("#")]),s._v(" Pod创建过程")]),s._v(" "),t("p",[s._v("各个组件监听apiserver")]),s._v(" "),t("ol",[t("li",[s._v("用户提交pod信息给apiserver")]),s._v(" "),t("li",[s._v("apiserver将pod信息存到etcd， 返回确认信息给客户端")]),s._v(" "),t("li",[s._v("apiserver反应etcd中pod的变化，其他组件watch跟踪变化")]),s._v(" "),t("li",[s._v("scheduler发现有新的pod要创建，为其分配主机并将结果更新值apiServer")]),s._v(" "),t("li",[s._v("node节点的kubelet发现新的pod,尝试调用docker,并返回apiServer")]),s._v(" "),t("li",[s._v("apiServer将收到pod信息存储到etcd")])]),s._v(" "),t("h2",{attrs:{id:"pod终止过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod终止过程"}},[s._v("#")]),s._v(" Pod终止过程")]),s._v(" "),t("ol",[t("li",[s._v("用户通知apiServer删除pod")]),s._v(" "),t("li",[s._v("apiserver中的pod对象信息随时间推移更新，宽限期间内（30s）,pod被视为dead")]),s._v(" "),t("li",[s._v("pod标记为 Terminating")]),s._v(" "),t("li",[s._v("kubelet 监听到pod对象装维Terminating， 启动pod关闭过程")]),s._v(" "),t("li",[s._v("端点控制器，监听到pod对象关闭行为，删除所有匹配到此端点的service端点列表")]),s._v(" "),t("li",[s._v("如果pod定义了preStop钩子，则表计为terminating后悔同步方式执行")]),s._v(" "),t("li",[s._v("pod对象中容器进程收到停止信号")]),s._v(" "),t("li",[s._v("宽限期结束后，若pod中还存在进程，pod强制终止")]),s._v(" "),t("li",[s._v("kubelet请求apiserver将pod宽限时间置0，从而完成删除操作，pod对用户不可见")])]),s._v(" "),t("h2",{attrs:{id:"初始化容器过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化容器过程"}},[s._v("#")]),s._v(" 初始化容器过程")]),s._v(" "),t("p",[s._v("就是在pod的主容器之前要运行的容器， 主要容器的前置工作")]),s._v(" "),t("ol",[t("li",[s._v("初始化容器运行时阻塞后面主容器的， 重启到成功为止")]),s._v(" "),t("li",[s._v("初始化容器有多个，必须按照顺序一个个运行成功，\n"),t("img",{attrs:{src:"https://sprintln-1256351233.cos.ap-shanghai.myqcloud.com/img/20220928225621.png",alt:"20220928225621"}})])]),s._v(" "),t("h3",{attrs:{id:"初始化容器的应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化容器的应用场景"}},[s._v("#")]),s._v(" 初始化容器的应用场景")]),s._v(" "),t("ul",[t("li",[s._v("提供主容器中不具备的工具程序或自定义代码")]),s._v(" "),t("li",[s._v("初始化容器和应用有依赖关系需要串行")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个nginx服务，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在启动前执行任务来测试一下mysql 和 redis服务是否正常")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("initcontainer\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.17.1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("initContainers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'util ping xxx.xx.xx -c 1; do echo waiting for mysql...; sleep 2; done;'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sh'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-c'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'util ping xxx.xx.xx -c 1; do echo waiting for redis...; sleep 2; done;'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);